# 色将棋 仕様書

## 1. 概要

このウェブアプリケーションは、将棋初心者でも直感的に遊べる視覚的にわかりやすいUI/UXを提供する将棋ゲームです。プレイヤーは駒の動きを視覚的に理解でき、危険な状況や取れる駒などが明示されます。

## 2. 基本機能

### 2.1. ゲームボード

- 9x9の将棋盤を表示
- 駒の配置は伝統的な将棋の初期配置に準拠
- マス目は適切なサイズで、視認性を確保

### 2.2. 駒のデザイン

- 自分の駒：濃い青色の枠
- 後手の駒：赤色の枠
- 駒の種類は伝統的な漢字一文字をアイコンとして表示し、視覚的に区別しやすい以下の色を基調として使用
  - 王将/玉将：黒系
  - 飛車：紫
  - 角行：緑
  - 金将：金色
  - 銀将：銀色
  - 桂馬：ベージュ
  - 香車：ピンク
  - 歩兵：白
- 成り駒は元の駒と視覚的に関連性があるデザインで、アイコンの漢字がオレンジになる

## 3. ユーザーインターフェース

### 3.1. 移動可能マス表示

- 画面には、すべての駒の移動可能マスにそのマスに対応した色が塗られる。
- あるマスに動ける駒が複数ある場合、そのマスは縦に分割され、それぞれの分割された長方形がコマの色に塗られる。
- 敵の移動可能マスには赤の縁、自分の移動可能マスには濃い青色の枠が表示される

### 3.2. 駒の選択と移動
- 駒をクリックすると選択状態になる
- 選択した駒が移動可能なマスは移動可能マス表示が点滅する
- クリック操作で駒を移動

### 3.3. 駒を取る・取られる表示機能
- 敵の駒を取ることができる場合、その駒に明るい青色で剣マークを表示
- 自分の駒が相手に取られる可能性がある場合、その駒に赤色で剣マークを表示

### 3.4. 持ち駒エリア

- 画面のサイドに持ち駒エリアを配置
- 自分の持ち駒は画面右下側、敵の持ち駒は画面左上側に表示

## 4. ゲームフロー表示

### 4.1. 手番表示

- 現在の手番プレイヤーを画面上部に大きく表示
- 先手番：「先手（あなた）の番です」と青色で表示
- 後手番：「後手（相手）の番です」と赤色で表示

### 4.2. 最後の一手表示

- 直前に動いた駒のマスを黄色の枠線でハイライト表示


## 5. ヘルプと学習機能

### 5.1. ヒント機能

- 初心者向けに「ヒント」ボタンを設置
- ヒントを押すと、良い手の候補が1〜3手表示される
- ヒントは任意でオフにできる

### 5.2. ルール参照

- 画面の隅に「?」ボタンを配置
- クリックすると各駒の動きパターンと基本ルールの説明が表示される
- 駒の動きは視覚的なアニメーションで説明

## 6. 設定オプション

### 6.1. 視覚効果の調整

- アニメーションの調整（あり/なし）
- 効果音のオン/オフ

## 6. UI/UXのレイアウト
- 操作ボタン（投了、待った、設定など）は画面下部にまとめて配置
- ヘルプや設定は右上の歯車アイコンからアクセス

## 段階的開発計画

### フェーズ1: 基本的な将棋盤と駒の実装 ✅ 完了
**目標**: 静的な将棋盤と駒の表示、基本的なUI構築

**実装済み内容**:
1. 9x9の将棋盤のHTML/CSS実装
2. 駒の初期配置と表示
3. 基本的なUI要素（手番表示、持ち駒エリアなど）
4. ダークモード対応
5. レスポンシブデザイン

**成果物**:
- 視覚的に美しい将棋盤と駒の表示
- 基本的なUI構造の完成
- ダークモード対応のテーマ切り替え機能

### フェーズ2: 基本的なゲームロジックの実装 ✅ 完了
**目標**: 将棋の基本ルールに従った駒の移動と取得の実装

**実装済み内容**:
1. 駒の移動ロジック
   - 各駒の移動パターンの実装
   - 移動可能マスの表示
   - 駒の選択と移動の処理
2. 駒を取る機能
   - 相手の駒を取得して持ち駒にする処理
   - 持ち駒エリアの表示更新
3. 手番の切り替え
   - 先手/後手の交代処理
   - 手番表示の更新
4. 成り駒の基本実装
   - 成り駒の条件判定（敵陣に入る・敵陣から動く）
   - 成り駒の選択ダイアログ
   - 成り駒の視覚的表現
5. 持ち駒を打つ機能
   - 持ち駒の選択と盤面への配置
   - 二歩禁止などの基本ルールの実装
6. ゲームフローの改良
   - 手番表示の改良
   - ゲーム状態の管理（進行中、一時停止など）
7. リセット機能の完全実装
8. 最後に動いた駒のハイライト表示

**成果物**:
- 将棋のルールに準拠した駒の移動ロジック
- 持ち駒を打つ機能
- 成り駒の基本機能
- より洗練されたゲームフロー

### フェーズ3: 視覚的なUI強化 - 基本機能 ✅ 完了
**目標**: 仕様書に記載されている基本的な視覚的機能の実装

**実装済み内容**:
1. 移動可能マスの高度な表示機能
   - 全駒の移動可能マスの色分け表示
   - 選択駒の移動可能マス点滅表示
2. 駒を取る・取られる表示機能
   - 敵の駒を取れる場合の青色剣マーク表示
   - 自分の駒が取られる可能性がある場合の赤色剣マーク表示
3. 視覚的UI設定機能
   - 移動可能マスの表示/非表示切り替え
   - 駒を取る・取られる表示の切り替え
   - 移動可能マスの透明度調整

**成果物**:
- 視覚的に強化された移動可能マス表示機能
- 駒を取る・取られる関係の視覚的表示
- より直感的に状況を把握できるUI
- ユーザー設定可能な視覚的オプション

### フェーズ4: 軽量AI対戦機能の実装
**目標**: ブラウザ内で動作する軽量な将棋AIによる対戦機能の実装

**実装内容**:
1. 軽量将棋AIエンジンの実装
   - JavaScript/TypeScriptによる簡易的な将棋AIの実装
   - 基本的な評価関数と探索アルゴリズムの実装
   - 難易度調整のための探索深さ制限機能
2. AI対戦UIの実装
   - ゲームモード選択（対人戦/AI対戦）
   - 難易度選択（初級/中級/上級）
   - 先手/後手の選択
3. AIの思考と表示
   - AI思考中の表示アニメーション
   - AIの指し手の実行と表示

**技術選定**:
1. AIエンジン: 
   - 純JavaScript/TypeScriptによる実装
   - ミニマックスアルゴリズムをベースにしたシンプルな探索
   - アルファベータ枝刈りによる最適化
   - 簡易的な評価関数（駒の価値、位置評価など）
2. 難易度設定:
   - 初級: 探索深さ1-2、ランダム要素あり
   - 中級: 探索深さ2-3
   - 上級: 探索深さ3-4

**成果物**:
- ブラウザ内で動作する軽量将棋AI
- 複数難易度のAI設定オプション
- サーバーレスで動作する対局機能

### フェーズ5: ゲームルールの完全実装
**目標**: 将棋の特殊ルールを含む完全なルール実装

**実装内容**:
1. 王手・詰みの判定
   - 王手状態の検出と表示
   - 詰み判定ロジック
2. 特殊ルールの完全実装
   - 打ち歩詰め禁止
   - 行き所のない駒の制限
3. 投了・待った機能の実装
4. ゲーム履歴の記録と再生機能
   - 棋譜の記録
   - 対局の再生機能

**成果物**:
- 将棋のルールに完全準拠したゲームプレイ
- 対人戦として遊べる基本機能の完成

### フェーズ6: アニメーションと効果音
**目標**: ゲーム体験を向上させるアニメーションと効果音の実装

**実装内容**:
1. アニメーション効果の追加
   - 駒の移動アニメーション
   - 駒を取る際のエフェクト
   - 成り駒の変化エフェクト
2. 効果音の実装
   - 駒の移動音
   - 駒を取る音
   - 成り駒の変化音
   - 王手・詰みの警告音
3. アニメーション・効果音の設定オプション
   - オン/オフ切り替え
   - 速度調整

**成果物**:
- 滑らかで視覚的に魅力的なアニメーション
- 適切な効果音によるフィードバック
- ユーザー設定可能なアニメーション・効果音オプション

### フェーズ7: ヘルプと学習機能の実装
**目標**: 初心者向けの補助機能の実装

**実装内容**:
1. ヒント機能の実装
   - 良い手の候補表示ロジック
   - ヒントボタンとUI
2. ルール参照機能の拡充
   - 駒の動きパターン表示
   - 基本ルール説明ページの強化
3. 初心者向けチュートリアルの実装
   - 対話式の将棋入門ガイド
   - 駒の動かし方練習モード
4. UIの最終調整
   - 操作ボタンの配置
   - ヘルプ・設定メニューの実装

**成果物**:
- 初心者をサポートする学習・ヘルプ機能
- ユーザー設定可能なオプション
- 完全に遊べる将棋ゲームの完成